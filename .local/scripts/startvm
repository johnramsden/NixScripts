#!/bin/sh

# startvm:
# John Ramsden, 2017
# Start a libvirt qemu://session virtual machine

vm=${1}
port=${2:-5900}

off=$(virsh -c qemu:///session list --all | grep " ${vm} " | awk '{ print $3}') ;

if ([ "x$off"=="x" ] || [ "x$off" != "xrunning" ]); then
  echo "Starting ${vm}";
  virsh -c qemu:///session start ${vm};
  spicy --host=localhost --port="${port}";
else
  echo "${vm} is already running";
  spicy --host=localhost --port="${port}";
fi
